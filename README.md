# PaMercedes

Парсер тем форума `benzclub.ru` на Python + Selenium.

## Паспорт проекта

- Название: `PaMercedes`
- Тип: CLI-утилита для сбора метаданных тем форума
- Язык: `Python 3.10+`
- Целевой источник: страницы вида `forumdisplay.php?f=<forum_id>&page=<n>`
- Основной результат: таблица тем с полями `title`, `url`, `replies`, `views`, `last_post`
- Форматы выгрузки: `CSV` и `JSON`

## Назначение

Проект автоматизирует сбор тем из выбранного раздела форума Mercedes Club.
Скрипт открывает страницы раздела, извлекает карточки тем, нормализует числовые и
временные значения и сохраняет результат в файлы для последующей аналитики.

## Состав репозитория

- `forum_parser.py` - основной скрипт парсинга и сохранения результатов.
- `save_cookies.py` - утилита для сохранения авторизационных cookies после ручного логина.
- `requirements.txt` - зависимости проекта.
- `.gitignore` - исключения для временных файлов и выгрузок.

## Как это работает

### Поток выполнения `forum_parser.py`

1. Парсер принимает параметры командной строки (ID форума, число страниц, задержки и т.д.).
2. Запускается Chrome WebDriver через `webdriver-manager`.
3. При переданном `--cookies` cookies подгружаются в браузер.
4. Скрипт по очереди открывает страницы раздела:
   `https://www.benzclub.ru/forum/forumdisplay.php?f=<forum_id>&page=<n>`.
5. HTML каждой страницы разбирается через `BeautifulSoup`.
6. Для каждой найденной темы извлекаются:
   `title`, `url`, `replies`, `views`, `last_post`.
7. Результаты агрегируются и сохраняются одновременно в `CSV` и `JSON`.

### Как определяется каждая метрика

- `title`: текст ссылки темы (`a[id^=thread_title_]`).
- `url`: абсолютная ссылка, собранная из базового URL форума и `href` темы.
- `replies`: число ответов из блока `who posted`.
- `views`: максимальное числовое значение среди целевых ячеек статистики строки.
- `last_post`: дата/время последнего поста, нормализованные в `ISO` (`YYYY-MM-DDTHH:MM`) при успешном парсинге.

## Установка

```bash
python -m venv .venv
. .venv/Scripts/activate
pip install -r requirements.txt
```

## Быстрый старт

### 1) Сохранить cookies (опционально)

Нужно, если раздел/контент доступен только авторизованным пользователям.

```bash
python save_cookies.py --output benzclub_cookies.pkl
```

После запуска откроется браузер: войдите в аккаунт вручную и нажмите `Enter` в терминале.

### 2) Запустить парсер

С cookies:

```bash
python forum_parser.py --forum-id 40 --pages 10 --cookies benzclub_cookies.pkl
```

Без cookies:

```bash
python forum_parser.py --forum-id 40 --pages 10
```

## Параметры `forum_parser.py`

- `--forum-id`: ID раздела форума (по умолчанию `40`).
- `--pages`: число страниц для обхода (по умолчанию `3`).
- `--delay`: задержка между загрузками страниц в секундах (по умолчанию `1.5`).
- `--headless`: запуск браузера без графического окна.
- `--cookies`: путь к файлу cookies в формате `.pkl`.
- `--output-csv`: путь к выходному CSV (по умолчанию `topics.csv`).
- `--output-json`: путь к выходному JSON (по умолчанию `topics.json`).

## Выходные файлы

- `topics.csv`
- `topics.json`

Оба файла содержат одинаковую структуру записей:

- `title`: заголовок темы.
- `url`: ссылка на тему.
- `replies`: количество ответов.
- `views`: количество просмотров.
- `last_post`: дата/время последнего сообщения или `null`/пусто, если дата не распознана.

## Ограничения и допущения

- Структура HTML форума может меняться; при изменениях CSS-селекторов понадобится обновление парсера.
- Точность полей `views` и `last_post` зависит от стабильности вёрстки строки темы.
- При высоком темпе запросов возможны блокировки; регулируйте `--delay`.

## Частые проблемы

- `Cookie file not found`: проверьте путь в `--cookies`.
- WebDriver не стартует: обновите Chrome и переустановите зависимости.
- Пустой результат: проверьте корректность `--forum-id` и доступность раздела без авторизации.
